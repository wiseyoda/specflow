<!DOCTYPE html>
<html lang="en" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SpecFlow - Claude v3</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.13.3/dist/cdn.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">

    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                        mono: ['JetBrains Mono', 'monospace'],
                    },
                    colors: {
                        surface: { 50: '#09090b', 100: '#0c0c0e', 200: '#18181b', 300: '#27272a', 400: '#3f3f46', 500: '#52525b' },
                        accent: { DEFAULT: '#6366f1', light: '#818cf8', dark: '#4f46e5' },
                        success: { DEFAULT: '#10b981', light: '#34d399' },
                        warning: { DEFAULT: '#f59e0b', light: '#fbbf24' },
                        danger: { DEFAULT: '#ef4444', light: '#f87171' },
                    },
                    animation: {
                        'glow-pulse': 'glow-pulse 2s ease-in-out infinite',
                        'slide-up': 'slide-up 0.3s ease-out',
                        'beam': 'beam 1.5s linear infinite',
                        'float': 'float 6s ease-in-out infinite',
                    },
                    keyframes: {
                        'glow-pulse': {
                            '0%, 100%': { opacity: '0.4' },
                            '50%': { opacity: '0.8' },
                        },
                        'slide-up': {
                            '0%': { transform: 'translateY(10px)', opacity: '0' },
                            '100%': { transform: 'translateY(0)', opacity: '1' },
                        },
                        'beam': {
                            '0%': { transform: 'translateX(-100%)' },
                            '100%': { transform: 'translateX(100%)' },
                        },
                        'float': {
                            '0%, 100%': { transform: 'translateY(0px)' },
                            '50%': { transform: 'translateY(-20px)' },
                        },
                    }
                }
            }
        }
    </script>

    <style>
        [x-cloak] { display: none !important; }

        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #3f3f46; border-radius: 3px; }
        ::-webkit-scrollbar-thumb:hover { background: #52525b; }

        .bg-grid {
            background-size: 32px 32px;
            background-image:
                linear-gradient(to right, rgba(99, 102, 241, 0.03) 1px, transparent 1px),
                linear-gradient(to bottom, rgba(99, 102, 241, 0.03) 1px, transparent 1px);
        }

        .cursor-blink::after {
            content: '▋';
            animation: blink 1s step-end infinite;
            color: #6366f1;
        }
        @keyframes blink { 50% { opacity: 0; } }

        .glass {
            background: rgba(24, 24, 27, 0.7);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
        }

        .omni-glow {
            background: linear-gradient(135deg,
                rgba(99, 102, 241, 0.15),
                rgba(139, 92, 246, 0.15),
                rgba(236, 72, 153, 0.1)
            );
            filter: blur(40px);
        }

        /* Smooth transitions for view changes */
        .view-transition {
            transition: opacity 0.3s ease, transform 0.3s ease;
        }
    </style>
</head>

<body class="bg-surface-50 text-zinc-300 font-sans h-screen overflow-hidden" x-data="app()" @keydown.window="handleKeydown($event)">

    <!-- Background layers -->
    <div class="fixed inset-0 bg-surface-50 z-0"></div>
    <div class="fixed inset-0 bg-grid z-0"></div>

    <!-- Floating orbs -->
    <div class="fixed top-20 left-1/4 w-[500px] h-[500px] rounded-full bg-accent/5 blur-[100px] animate-float z-0 pointer-events-none"></div>
    <div class="fixed bottom-20 right-1/4 w-[400px] h-[400px] rounded-full bg-purple-500/5 blur-[80px] animate-float z-0 pointer-events-none" style="animation-delay: -3s;"></div>

    <!-- App container -->
    <div class="relative z-10 h-full flex">

        <!-- Icon Sidebar -->
        <aside class="w-16 flex flex-col items-center py-4 border-r border-surface-300/50 bg-surface-100/80 backdrop-blur-xl z-30">

            <!-- Logo -->
            <div class="w-10 h-10 rounded-xl bg-gradient-to-br from-accent to-purple-500 flex items-center justify-center text-white font-bold text-sm shadow-lg shadow-accent/25 mb-6 cursor-pointer hover:scale-110 hover:shadow-accent/40 transition-all duration-200">
                SF
            </div>

            <!-- Navigation -->
            <nav class="flex-1 flex flex-col gap-2 w-full px-2">
                <template x-for="item in navItems" :key="item.id">
                    <button @click="activeView = item.id"
                            class="group relative w-12 h-12 mx-auto rounded-xl flex items-center justify-center transition-all duration-200"
                            :class="activeView === item.id
                                ? 'bg-white/10 text-white shadow-lg shadow-black/20'
                                : 'text-zinc-500 hover:text-zinc-300 hover:bg-white/5'">

                        <i :class="item.icon" class="text-lg"></i>

                        <!-- Live indicator for session -->
                        <span x-show="item.id === 'session' && status === 'running'"
                              class="absolute top-2 right-2 w-2 h-2 rounded-full bg-success animate-pulse"></span>

                        <!-- Pending indicator for session when waiting -->
                        <span x-show="item.id === 'session' && status === 'waiting'"
                              class="absolute top-2 right-2 w-2 h-2 rounded-full bg-warning animate-pulse"></span>

                        <!-- Active indicator pip -->
                        <div x-show="activeView === item.id"
                             class="absolute left-0 top-1/2 -translate-y-1/2 w-1 h-6 bg-accent rounded-r-full shadow-lg shadow-accent/50"
                             x-transition></div>

                        <!-- Tooltip -->
                        <div class="absolute left-full ml-3 px-3 py-2 bg-surface-200 border border-surface-300 rounded-lg shadow-xl opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none whitespace-nowrap z-50">
                            <div class="flex items-center gap-3">
                                <span class="text-sm font-medium text-white" x-text="item.label"></span>
                                <kbd class="px-1.5 py-0.5 rounded bg-surface-300 text-zinc-500 text-[10px] font-mono" x-text="item.hotkey"></kbd>
                            </div>
                        </div>
                    </button>
                </template>
            </nav>

            <!-- Bottom section -->
            <div class="flex flex-col gap-3 w-full px-2">
                <!-- Notifications -->
                <button @click="showNotifications = !showNotifications"
                        class="group relative w-12 h-12 mx-auto rounded-xl flex items-center justify-center text-zinc-500 hover:text-zinc-300 hover:bg-white/5 transition-all">
                    <i class="fa-solid fa-bell text-lg"></i>
                    <span x-show="notifications.length > 0"
                          class="absolute top-2 right-2 w-2 h-2 rounded-full bg-danger animate-pulse"></span>
                    <div class="absolute left-full ml-3 px-3 py-2 bg-surface-200 border border-surface-300 rounded-lg shadow-xl opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none whitespace-nowrap z-50">
                        <span class="text-sm font-medium text-white">Notifications</span>
                    </div>
                </button>

                <!-- Settings -->
                <button class="group relative w-12 h-12 mx-auto rounded-xl flex items-center justify-center text-zinc-500 hover:text-zinc-300 hover:bg-white/5 transition-all">
                    <i class="fa-solid fa-gear text-lg"></i>
                    <div class="absolute left-full ml-3 px-3 py-2 bg-surface-200 border border-surface-300 rounded-lg shadow-xl opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none whitespace-nowrap z-50">
                        <span class="text-sm font-medium text-white">Settings</span>
                    </div>
                </button>

                <!-- Avatar -->
                <div class="w-10 h-10 mx-auto rounded-full bg-gradient-to-br from-orange-400 to-pink-500 ring-2 ring-surface-300 cursor-pointer hover:ring-accent/50 transition-all"></div>
            </div>
        </aside>

        <!-- Main content area -->
        <main class="flex-1 flex flex-col relative overflow-hidden">

            <!-- Header -->
            <header class="h-14 flex items-center justify-between px-6 border-b border-surface-300/50 glass shrink-0 z-20">

                <!-- Left: Breadcrumb + Branch -->
                <div class="flex items-center gap-3">
                    <span class="text-zinc-600 text-sm">~/dev/specflow</span>
                    <i class="fa-solid fa-chevron-right text-[8px] text-zinc-700"></i>
                    <div class="flex items-center gap-2 px-2.5 py-1 rounded-lg bg-purple-500/10 border border-purple-500/20">
                        <i class="fa-solid fa-code-branch text-xs text-purple-400"></i>
                        <span class="text-sm text-purple-300 font-medium">feature/1051</span>
                    </div>
                </div>

                <!-- Center: Status Pill -->
                <div class="absolute left-1/2 -translate-x-1/2">
                    <div class="flex items-center gap-3 px-4 py-2 rounded-full glass border transition-all duration-300"
                         :class="{
                             'border-surface-300/50': status === 'idle',
                             'border-success/30 shadow-lg shadow-success/10': status === 'running',
                             'border-warning/30 shadow-lg shadow-warning/10': status === 'waiting',
                             'border-danger/30 shadow-lg shadow-danger/10': status === 'failed'
                         }">

                        <!-- Status dot -->
                        <span class="relative flex h-2.5 w-2.5">
                            <span x-show="status !== 'idle'"
                                  class="animate-ping absolute inline-flex h-full w-full rounded-full opacity-75"
                                  :class="{
                                      'bg-success': status === 'running',
                                      'bg-warning': status === 'waiting',
                                      'bg-danger': status === 'failed'
                                  }"></span>
                            <span class="relative inline-flex rounded-full h-2.5 w-2.5"
                                  :class="{
                                      'bg-zinc-500': status === 'idle',
                                      'bg-success': status === 'running',
                                      'bg-warning': status === 'waiting',
                                      'bg-danger': status === 'failed'
                                  }"></span>
                        </span>

                        <!-- Status text -->
                        <span class="text-xs font-medium uppercase tracking-wider"
                              :class="{
                                  'text-zinc-400': status === 'idle',
                                  'text-success': status === 'running',
                                  'text-warning': status === 'waiting',
                                  'text-danger': status === 'failed'
                              }"
                              x-text="statusLabel"></span>

                        <!-- Timer (when running) -->
                        <template x-if="status === 'running' || status === 'waiting'">
                            <div class="flex items-center gap-2">
                                <span class="w-px h-4 bg-surface-400"></span>
                                <span class="text-xs font-mono text-zinc-400" x-text="timer"></span>
                            </div>
                        </template>
                    </div>
                </div>

                <!-- Right: Context toggle -->
                <div class="flex items-center gap-2">
                    <button @click="contextOpen = !contextOpen"
                            class="flex items-center gap-2 px-3 py-1.5 rounded-lg border border-surface-300/50 hover:bg-white/5 text-zinc-400 hover:text-white transition-all">
                        <i class="fa-solid fa-sidebar-flip text-sm"></i>
                        <span class="text-xs font-medium">Context</span>
                    </button>
                </div>
            </header>

            <!-- Content area -->
            <div class="flex-1 flex relative overflow-hidden">

                <!-- Main views -->
                <div class="flex-1 flex flex-col relative">

                    <!-- DASHBOARD VIEW (idle state welcome) -->
                    <div x-show="activeView === 'dashboard' && status === 'idle'"
                         x-transition:enter="transition ease-out duration-300"
                         x-transition:enter-start="opacity-0 scale-95"
                         x-transition:enter-end="opacity-100 scale-100"
                         class="absolute inset-0 flex flex-col items-center justify-center p-8 z-10">

                        <div class="max-w-xl w-full text-center space-y-8">
                            <!-- Greeting -->
                            <div class="space-y-3">
                                <h1 class="text-4xl font-bold text-white tracking-tight">
                                    Ready to build?
                                </h1>
                                <p class="text-zinc-400 text-lg">
                                    Phase <span class="text-accent font-medium">0042</span> is 80% complete. 3 tasks remaining.
                                </p>
                            </div>

                            <!-- Quick actions -->
                            <div class="grid grid-cols-1 gap-4">
                                <!-- Primary action -->
                                <button @click="startWorkflow('implement')"
                                        class="group relative p-6 rounded-2xl bg-gradient-to-br from-surface-200/80 to-surface-200/40 border border-surface-300/50 hover:border-accent/50 transition-all duration-300 text-left overflow-hidden">

                                    <div class="absolute inset-0 bg-gradient-to-br from-accent/5 to-purple-500/5 opacity-0 group-hover:opacity-100 transition-opacity"></div>

                                    <div class="relative flex items-center justify-between">
                                        <div class="flex items-center gap-4">
                                            <div class="w-14 h-14 rounded-xl bg-accent/20 flex items-center justify-center text-accent text-xl group-hover:scale-110 transition-transform">
                                                <i class="fa-solid fa-play"></i>
                                            </div>
                                            <div>
                                                <h3 class="text-lg font-semibold text-white group-hover:text-accent transition-colors">Resume Implementation</h3>
                                                <p class="text-sm text-zinc-500">Continue working on T013 - Input validation</p>
                                            </div>
                                        </div>
                                        <i class="fa-solid fa-arrow-right text-zinc-600 group-hover:text-accent group-hover:translate-x-1 transition-all"></i>
                                    </div>
                                </button>

                                <!-- Secondary actions -->
                                <div class="grid grid-cols-3 gap-3">
                                    <button @click="startWorkflow('orchestrate')"
                                            class="group p-4 rounded-xl bg-surface-200/50 border border-surface-300/50 hover:border-accent/30 transition-all text-left">
                                        <div class="w-10 h-10 rounded-lg bg-indigo-500/20 flex items-center justify-center text-indigo-400 mb-3 group-hover:scale-110 transition-transform">
                                            <i class="fa-solid fa-layer-group"></i>
                                        </div>
                                        <h4 class="text-sm font-medium text-white">Orchestrate</h4>
                                        <p class="text-xs text-zinc-500 mt-1">End-to-end</p>
                                    </button>

                                    <button @click="startWorkflow('design')"
                                            class="group p-4 rounded-xl bg-surface-200/50 border border-surface-300/50 hover:border-pink-500/30 transition-all text-left">
                                        <div class="w-10 h-10 rounded-lg bg-pink-500/20 flex items-center justify-center text-pink-400 mb-3 group-hover:scale-110 transition-transform">
                                            <i class="fa-solid fa-pencil-ruler"></i>
                                        </div>
                                        <h4 class="text-sm font-medium text-white">Design</h4>
                                        <p class="text-xs text-zinc-500 mt-1">Spec & plan</p>
                                    </button>

                                    <button @click="startWorkflow('verify')"
                                            class="group p-4 rounded-xl bg-surface-200/50 border border-surface-300/50 hover:border-amber-500/30 transition-all text-left">
                                        <div class="w-10 h-10 rounded-lg bg-amber-500/20 flex items-center justify-center text-amber-400 mb-3 group-hover:scale-110 transition-transform">
                                            <i class="fa-solid fa-clipboard-check"></i>
                                        </div>
                                        <h4 class="text-sm font-medium text-white">Verify</h4>
                                        <p class="text-xs text-zinc-500 mt-1">Checklists</p>
                                    </button>
                                </div>
                            </div>

                            <!-- Stats row -->
                            <div class="flex items-center justify-center gap-8 pt-4">
                                <div class="text-center">
                                    <div class="text-2xl font-bold text-success">12</div>
                                    <div class="text-xs text-zinc-500 uppercase tracking-wide">Done</div>
                                </div>
                                <div class="w-px h-8 bg-surface-300"></div>
                                <div class="text-center">
                                    <div class="text-2xl font-bold text-warning">3</div>
                                    <div class="text-xs text-zinc-500 uppercase tracking-wide">Pending</div>
                                </div>
                                <div class="w-px h-8 bg-surface-300"></div>
                                <div class="text-center">
                                    <div class="text-2xl font-bold text-accent">80%</div>
                                    <div class="text-xs text-zinc-500 uppercase tracking-wide">Progress</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- SESSION VIEW (console) -->
                    <div x-show="activeView === 'session'"
                         x-transition:enter="transition ease-out duration-300"
                         x-transition:enter-start="opacity-0"
                         x-transition:enter-end="opacity-100"
                         class="absolute inset-0 flex flex-col z-10">

                        <!-- Console output -->
                        <div class="flex-1 p-6 font-mono text-sm overflow-y-auto space-y-6" id="console">

                            <!-- System init -->
                            <div class="opacity-50 space-y-2">
                                <div class="flex gap-4">
                                    <span class="text-zinc-600 shrink-0 select-none w-16">14:02:11</span>
                                    <span class="text-purple-400 font-semibold">System</span>
                                    <span class="text-zinc-400">Initializing context analysis...</span>
                                </div>
                                <div class="flex gap-4">
                                    <span class="text-zinc-600 shrink-0 select-none w-16">14:02:15</span>
                                    <span class="text-blue-400 font-semibold">Glob</span>
                                    <span class="text-zinc-400">Found 12 files matching <code class="px-1.5 py-0.5 rounded bg-surface-300 text-zinc-300">src/**/*.ts</code></span>
                                </div>
                            </div>

                            <!-- Agent thought -->
                            <div class="relative pl-6 border-l-2 border-surface-300 hover:border-accent/50 transition-colors group">
                                <div class="absolute -left-[5px] top-0 w-2 h-2 rounded-full bg-accent shadow-lg shadow-accent/50"></div>

                                <div class="flex items-center gap-3 mb-2">
                                    <span class="text-accent font-bold">@Implementer</span>
                                    <span class="px-2 py-0.5 rounded-full bg-accent/10 text-accent text-[10px] uppercase tracking-wider border border-accent/20">reasoning</span>
                                </div>

                                <p class="text-zinc-300 leading-relaxed">
                                    I need to locate the authentication middleware to inject the new JWT validation logic. Based on the file structure, it's likely in
                                    <span class="text-amber-300 bg-amber-500/10 px-1.5 py-0.5 rounded">src/middleware/auth.ts</span>. Let me read that file.
                                </p>
                            </div>

                            <!-- Tool call -->
                            <div class="bg-surface-100 rounded-xl border border-surface-300 overflow-hidden">
                                <div class="flex items-center justify-between px-4 py-2 bg-surface-200 border-b border-surface-300">
                                    <div class="flex items-center gap-2">
                                        <i class="fa-solid fa-terminal text-purple-400 text-xs"></i>
                                        <span class="text-purple-400 font-semibold text-xs">Read</span>
                                    </div>
                                    <span class="text-zinc-500 text-xs">src/middleware/auth.ts</span>
                                </div>
                                <pre class="p-4 text-xs text-zinc-400 overflow-x-auto"><code>export const authMiddleware = (req, res, next) => {
  const token = req.headers.authorization;
  if (!token) {
    return res.status(401).json({ error: 'No token provided' });
  }
  // ... validation logic
  next();
};</code></pre>
                            </div>

                            <!-- Another thought -->
                            <div class="relative pl-6 border-l-2 border-surface-300 hover:border-accent/50 transition-colors">
                                <div class="absolute -left-[5px] top-0 w-2 h-2 rounded-full bg-accent shadow-lg shadow-accent/50"></div>

                                <div class="flex items-center gap-3 mb-2">
                                    <span class="text-accent font-bold">@Implementer</span>
                                    <span class="px-2 py-0.5 rounded-full bg-success/10 text-success text-[10px] uppercase tracking-wider border border-success/20">action</span>
                                </div>

                                <p class="text-zinc-300 leading-relaxed mb-3">
                                    I'll implement the Zod validation schema for the login endpoint:
                                </p>

                                <div class="bg-surface-100 rounded-lg border border-surface-300 overflow-hidden">
                                    <div class="flex items-center justify-between px-3 py-1.5 bg-surface-200 border-b border-surface-300">
                                        <span class="text-xs text-zinc-500">src/auth/validation.ts</span>
                                        <span class="text-[10px] text-success">+24 lines</span>
                                    </div>
                                    <pre class="p-3 text-xs text-zinc-400 overflow-x-auto"><code class="text-emerald-300">import { z } from 'zod';

export const loginSchema = z.object({
  email: z.string().email('Invalid email format'),
  password: z.string().min(8, 'Password must be at least 8 characters'),
});</code></pre>
                                </div>
                            </div>

                            <!-- Typing indicator -->
                            <div x-show="status === 'running'" class="flex items-center gap-3">
                                <div class="w-6 h-6 rounded-full bg-accent/20 flex items-center justify-center text-accent text-xs animate-pulse">
                                    <i class="fa-solid fa-robot"></i>
                                </div>
                                <span class="text-zinc-500">Analyzing dependencies</span>
                                <span class="cursor-blink"></span>
                            </div>

                            <!-- Empty state when idle and viewing session -->
                            <div x-show="status === 'idle'" class="flex flex-col items-center justify-center h-full text-center">
                                <div class="w-16 h-16 rounded-2xl bg-surface-200 flex items-center justify-center text-zinc-600 mb-4">
                                    <i class="fa-solid fa-terminal text-2xl"></i>
                                </div>
                                <h3 class="text-lg font-medium text-zinc-400 mb-2">No active session</h3>
                                <p class="text-sm text-zinc-600 max-w-sm mb-6">Start a workflow to see live output, tool calls, and agent reasoning here.</p>
                                <div class="flex gap-3">
                                    <button @click="startWorkflow('implement')" class="px-5 py-2.5 rounded-xl bg-accent hover:bg-accent-light text-white text-sm font-medium transition-colors shadow-lg shadow-accent/25">
                                        <i class="fa-solid fa-play mr-2"></i>Start Workflow
                                    </button>
                                    <button @click="activeView = 'dashboard'" class="px-5 py-2.5 rounded-xl bg-surface-200 hover:bg-surface-300 border border-surface-300 text-zinc-300 text-sm font-medium transition-colors">
                                        View Dashboard
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- Omni-box -->
                        <div class="p-4 shrink-0">
                            <div class="relative group max-w-3xl mx-auto">
                                <!-- Glow effect -->
                                <div class="absolute -inset-1 omni-glow rounded-2xl opacity-0 group-hover:opacity-100 group-focus-within:opacity-100 transition-opacity duration-500"></div>

                                <!-- Input container -->
                                <div class="relative bg-surface-200 border border-surface-300 group-hover:border-surface-400 group-focus-within:border-accent/50 rounded-xl flex items-center p-2 shadow-2xl transition-all duration-300">

                                    <!-- State badge -->
                                    <div class="flex items-center gap-2 px-3 py-1.5 rounded-lg transition-colors mr-2"
                                         :class="{
                                             'bg-success/10 border border-success/20': status === 'running',
                                             'bg-warning/10 border border-warning/20': status === 'waiting',
                                             'bg-danger/10 border border-danger/20': status === 'failed',
                                             'bg-surface-300': status === 'idle'
                                         }">
                                        <span class="w-2 h-2 rounded-full"
                                              :class="{
                                                  'bg-success animate-pulse': status === 'running',
                                                  'bg-warning animate-pulse': status === 'waiting',
                                                  'bg-danger': status === 'failed',
                                                  'bg-zinc-500': status === 'idle'
                                              }"></span>
                                        <span class="text-xs font-medium"
                                              :class="{
                                                  'text-success': status === 'running',
                                                  'text-warning': status === 'waiting',
                                                  'text-danger': status === 'failed',
                                                  'text-zinc-400': status === 'idle'
                                              }"
                                              x-text="status === 'running' ? 'Live' : status === 'waiting' ? 'Waiting' : status === 'failed' ? 'Error' : 'Ready'"></span>
                                    </div>

                                    <!-- Input -->
                                    <input type="text"
                                           x-model="inputValue"
                                           @keydown.enter="sendMessage()"
                                           @keydown.meta.k.prevent="inputFocused = true; $el.focus()"
                                           :placeholder="status === 'running' ? 'Type to intervene or guide...' : status === 'waiting' ? 'Respond to the question...' : 'Ask SpecFlow to do something...'"
                                           class="flex-1 bg-transparent border-none focus:ring-0 text-white placeholder-zinc-600 text-sm h-10 min-w-0">

                                    <!-- Actions -->
                                    <div class="flex items-center gap-1 px-1">
                                        <button class="w-9 h-9 rounded-lg hover:bg-white/10 text-zinc-500 hover:text-white transition-colors">
                                            <i class="fa-solid fa-paperclip"></i>
                                        </button>
                                        <button @click="sendMessage()"
                                                class="w-9 h-9 rounded-lg bg-accent hover:bg-accent-light text-white shadow-lg shadow-accent/25 transition-all">
                                            <i class="fa-solid fa-arrow-up"></i>
                                        </button>
                                    </div>
                                </div>

                                <!-- Hint -->
                                <div class="absolute -bottom-6 left-1/2 -translate-x-1/2 text-[10px] text-zinc-600">
                                    Press <kbd class="px-1.5 py-0.5 rounded bg-surface-300 text-zinc-500 font-mono">⌘K</kbd> to focus
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- TASKS VIEW -->
                    <div x-show="activeView === 'tasks'"
                         x-transition:enter="transition ease-out duration-300"
                         x-transition:enter-start="opacity-0"
                         x-transition:enter-end="opacity-100"
                         class="absolute inset-0 flex flex-col p-6 z-10 overflow-hidden">

                        <div class="flex items-center justify-between mb-6">
                            <h2 class="text-xl font-bold text-white">Tasks</h2>
                            <div class="flex items-center gap-2 text-sm">
                                <span class="text-zinc-400">12 of 15 complete</span>
                                <div class="w-24 h-1.5 bg-surface-300 rounded-full overflow-hidden">
                                    <div class="w-4/5 h-full bg-accent rounded-full"></div>
                                </div>
                            </div>
                        </div>

                        <div class="flex-1 flex gap-6 overflow-hidden">
                            <!-- To Do -->
                            <div class="w-80 flex flex-col">
                                <div class="flex items-center gap-2 mb-4 px-1">
                                    <div class="w-2 h-2 rounded-full bg-zinc-500"></div>
                                    <span class="text-sm font-semibold text-zinc-400">To Do</span>
                                    <span class="px-2 py-0.5 rounded-full bg-surface-300 text-zinc-500 text-xs">3</span>
                                </div>
                                <div class="flex-1 bg-surface-200/30 rounded-xl border border-surface-300/50 p-3 space-y-3 overflow-y-auto">
                                    <div class="bg-surface-200 p-4 rounded-xl border border-surface-300 hover:border-accent/30 cursor-pointer transition-all group">
                                        <div class="flex justify-between items-start mb-2">
                                            <span class="text-xs font-mono text-zinc-600">T013</span>
                                            <span class="px-2 py-0.5 rounded text-[10px] font-bold uppercase bg-warning/20 text-warning border border-warning/30">High</span>
                                        </div>
                                        <p class="text-sm font-medium text-zinc-200 group-hover:text-white">Add input validation for user forms</p>
                                    </div>
                                    <div class="bg-surface-200 p-4 rounded-xl border border-surface-300 hover:border-accent/30 cursor-pointer transition-all group">
                                        <div class="flex justify-between items-start mb-2">
                                            <span class="text-xs font-mono text-zinc-600">T014</span>
                                        </div>
                                        <p class="text-sm font-medium text-zinc-200 group-hover:text-white">Write unit tests for auth module</p>
                                    </div>
                                    <div class="bg-surface-200 p-4 rounded-xl border border-surface-300 hover:border-accent/30 cursor-pointer transition-all group">
                                        <div class="flex justify-between items-start mb-2">
                                            <span class="text-xs font-mono text-zinc-600">T015</span>
                                        </div>
                                        <p class="text-sm font-medium text-zinc-200 group-hover:text-white">Update API documentation</p>
                                    </div>
                                </div>
                            </div>

                            <!-- Done -->
                            <div class="w-80 flex flex-col">
                                <div class="flex items-center gap-2 mb-4 px-1">
                                    <div class="w-2 h-2 rounded-full bg-success"></div>
                                    <span class="text-sm font-semibold text-success">Done</span>
                                    <span class="px-2 py-0.5 rounded-full bg-success/20 text-success text-xs border border-success/30">12</span>
                                </div>
                                <div class="flex-1 bg-surface-200/30 rounded-xl border border-surface-300/50 p-3 space-y-3 overflow-y-auto">
                                    <div class="bg-surface-200 p-4 rounded-xl border border-surface-300 opacity-60 hover:opacity-100 transition-all cursor-pointer">
                                        <div class="flex justify-between items-start mb-2">
                                            <span class="text-xs font-mono text-zinc-600 line-through">T012</span>
                                            <i class="fa-solid fa-check text-success text-xs"></i>
                                        </div>
                                        <p class="text-sm text-zinc-500 line-through">Implement JWT token generation</p>
                                    </div>
                                    <div class="bg-surface-200 p-4 rounded-xl border border-surface-300 opacity-60 hover:opacity-100 transition-all cursor-pointer">
                                        <div class="flex justify-between items-start mb-2">
                                            <span class="text-xs font-mono text-zinc-600 line-through">T011</span>
                                            <i class="fa-solid fa-check text-success text-xs"></i>
                                        </div>
                                        <p class="text-sm text-zinc-500 line-through">Create user model and migrations</p>
                                    </div>
                                    <div class="bg-surface-200 p-4 rounded-xl border border-surface-300 opacity-60 hover:opacity-100 transition-all cursor-pointer">
                                        <div class="flex justify-between items-start mb-2">
                                            <span class="text-xs font-mono text-zinc-600 line-through">T010</span>
                                            <i class="fa-solid fa-check text-success text-xs"></i>
                                        </div>
                                        <p class="text-sm text-zinc-500 line-through">Set up database connection</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- HISTORY VIEW -->
                    <div x-show="activeView === 'history'"
                         x-transition:enter="transition ease-out duration-300"
                         x-transition:enter-start="opacity-0"
                         x-transition:enter-end="opacity-100"
                         class="absolute inset-0 flex gap-6 p-6 z-10 overflow-hidden">

                        <!-- Timeline -->
                        <div class="w-80 overflow-y-auto pr-2">
                            <h2 class="text-xl font-bold text-white mb-6">Phase History</h2>

                            <div class="relative border-l-2 border-surface-300 ml-2 space-y-4">
                                <template x-for="(phase, index) in phases" :key="phase.number">
                                    <div class="relative pl-6 cursor-pointer" @click="selectedPhase = index">
                                        <div class="absolute -left-[5px] top-2 w-2.5 h-2.5 rounded-full border-2 transition-all"
                                             :class="selectedPhase === index
                                                 ? (phase.status === 'current' ? 'bg-accent border-accent shadow-lg shadow-accent/50' : 'bg-success border-success shadow-lg shadow-success/50')
                                                 : 'bg-surface-100 border-surface-400 hover:border-accent'"></div>

                                        <div class="p-4 rounded-xl border transition-all"
                                             :class="selectedPhase === index ? 'bg-surface-200 border-accent/30 shadow-lg' : 'bg-surface-200/50 border-surface-300/50 hover:bg-surface-200'">
                                            <div class="flex items-center gap-2 mb-1">
                                                <span class="text-xs font-mono" :class="phase.status === 'current' ? 'text-accent' : 'text-success'" x-text="phase.number"></span>
                                                <span class="px-2 py-0.5 rounded text-[10px] font-medium border"
                                                      :class="phase.status === 'current' ? 'bg-accent/10 text-accent border-accent/20' : 'bg-purple-500/10 text-purple-400 border-purple-500/20'"
                                                      x-text="phase.status === 'current' ? 'Current' : 'Merged'"></span>
                                            </div>
                                            <h3 class="text-sm font-semibold text-zinc-200 mb-1" x-text="phase.name"></h3>
                                            <p class="text-xs text-zinc-500" x-text="phase.meta"></p>
                                        </div>
                                    </div>
                                </template>
                            </div>
                        </div>

                        <!-- Detail panel -->
                        <div class="flex-1 bg-surface-200 rounded-xl border border-surface-300 overflow-hidden flex flex-col">
                            <div class="flex items-center justify-between px-6 py-4 border-b border-surface-300 bg-surface-100">
                                <div class="flex items-center gap-3">
                                    <div class="w-10 h-10 rounded-xl bg-surface-300 flex items-center justify-center text-zinc-500">
                                        <i class="fa-solid fa-folder-open"></i>
                                    </div>
                                    <div>
                                        <h3 class="text-sm font-semibold text-white" x-text="phases[selectedPhase]?.name"></h3>
                                        <p class="text-xs text-zinc-500">Phase <span x-text="phases[selectedPhase]?.number"></span></p>
                                    </div>
                                </div>
                            </div>

                            <div class="flex-1 p-6 overflow-y-auto space-y-6">
                                <div>
                                    <h4 class="text-xs font-semibold text-zinc-500 uppercase tracking-wider mb-3">Summary</h4>
                                    <p class="text-sm text-zinc-400 leading-relaxed" x-text="phases[selectedPhase]?.summary"></p>
                                </div>

                                <div>
                                    <h4 class="text-xs font-semibold text-zinc-500 uppercase tracking-wider mb-3">Sessions</h4>
                                    <div class="space-y-2">
                                        <template x-for="session in phases[selectedPhase]?.sessions" :key="session.id">
                                            <div class="flex items-center justify-between p-3 bg-surface-100 rounded-lg border border-surface-300 hover:border-accent/30 cursor-pointer transition-all">
                                                <div class="flex items-center gap-3">
                                                    <span class="text-xs text-zinc-500" x-text="session.date"></span>
                                                    <span class="text-sm text-zinc-300" x-text="session.skill"></span>
                                                </div>
                                                <span class="text-xs text-zinc-500 font-mono" x-text="'$' + session.cost"></span>
                                            </div>
                                        </template>
                                    </div>
                                </div>

                                <div>
                                    <h4 class="text-xs font-semibold text-zinc-500 uppercase tracking-wider mb-3">Artifacts</h4>
                                    <div class="flex flex-wrap gap-2">
                                        <template x-for="artifact in phases[selectedPhase]?.artifacts" :key="artifact">
                                            <a href="#" class="px-3 py-2 bg-surface-100 rounded-lg border border-surface-300 text-sm text-zinc-400 hover:text-white hover:border-accent/30 transition-all">
                                                <i class="fa-solid fa-file-lines mr-2"></i><span x-text="artifact"></span>
                                            </a>
                                        </template>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Context drawer (right side) -->
                <aside x-show="contextOpen"
                       x-transition:enter="transition ease-out duration-200"
                       x-transition:enter-start="opacity-0 translate-x-4"
                       x-transition:enter-end="opacity-100 translate-x-0"
                       class="w-72 border-l border-surface-300/50 bg-surface-100/80 backdrop-blur-xl flex flex-col shrink-0 z-20">

                    <!-- Tabs -->
                    <div class="flex border-b border-surface-300">
                        <button @click="contextTab = 'context'"
                                class="flex-1 py-3 text-xs font-medium transition-colors"
                                :class="contextTab === 'context' ? 'text-white border-b-2 border-accent bg-white/5' : 'text-zinc-500 hover:text-zinc-300'">
                            Context
                        </button>
                        <button @click="contextTab = 'activity'"
                                class="flex-1 py-3 text-xs font-medium transition-colors"
                                :class="contextTab === 'activity' ? 'text-white border-b-2 border-accent bg-white/5' : 'text-zinc-500 hover:text-zinc-300'">
                            Activity
                        </button>
                    </div>

                    <div class="flex-1 overflow-y-auto p-4 space-y-6">

                        <!-- Context tab -->
                        <template x-if="contextTab === 'context'">
                            <div class="space-y-6">
                                <!-- Current task -->
                                <div>
                                    <h3 class="text-xs font-semibold text-zinc-500 uppercase tracking-wider mb-3">Current Task</h3>
                                    <div class="p-4 rounded-xl bg-surface-200 border border-surface-300">
                                        <div class="flex justify-between items-start mb-2">
                                            <span class="font-mono text-xs text-accent">T013</span>
                                            <span class="px-2 py-0.5 rounded text-[10px] font-bold bg-warning/20 text-warning border border-warning/30">HIGH</span>
                                        </div>
                                        <p class="text-sm text-zinc-200 font-medium mb-3">Add input validation for user forms</p>
                                        <div class="flex items-center gap-2">
                                            <div class="flex-1 h-1.5 bg-surface-300 rounded-full overflow-hidden">
                                                <div class="h-full bg-accent w-2/3 rounded-full"></div>
                                            </div>
                                            <span class="text-[10px] text-zinc-500">65%</span>
                                        </div>
                                    </div>
                                </div>

                                <!-- Touched files -->
                                <div>
                                    <h3 class="text-xs font-semibold text-zinc-500 uppercase tracking-wider mb-3">Touched Files</h3>
                                    <div class="space-y-1">
                                        <div class="flex items-center gap-2 p-2 rounded-lg hover:bg-white/5 cursor-pointer group transition-colors">
                                            <i class="fa-solid fa-file-code text-zinc-600 group-hover:text-accent transition-colors"></i>
                                            <span class="text-sm text-zinc-300 font-mono truncate flex-1">src/middleware/auth.ts</span>
                                            <span class="text-[10px] text-success">+12</span>
                                        </div>
                                        <div class="flex items-center gap-2 p-2 rounded-lg hover:bg-white/5 cursor-pointer group transition-colors">
                                            <i class="fa-solid fa-file-code text-zinc-600 group-hover:text-accent transition-colors"></i>
                                            <span class="text-sm text-zinc-300 font-mono truncate flex-1">src/auth/validation.ts</span>
                                            <span class="text-[10px] text-success">+24</span>
                                        </div>
                                        <div class="flex items-center gap-2 p-2 rounded-lg hover:bg-white/5 cursor-pointer group transition-colors">
                                            <i class="fa-solid fa-file-code text-zinc-600 group-hover:text-accent transition-colors"></i>
                                            <span class="text-sm text-zinc-300 font-mono truncate flex-1">src/types/express.d.ts</span>
                                            <span class="text-[10px] text-warning">~2</span>
                                        </div>
                                    </div>
                                </div>

                                <!-- Phase progress -->
                                <div>
                                    <h3 class="text-xs font-semibold text-zinc-500 uppercase tracking-wider mb-3">Phase Progress</h3>
                                    <div class="space-y-3">
                                        <div class="flex items-center gap-3">
                                            <div class="w-6 h-6 rounded-full bg-success/20 flex items-center justify-center text-success text-xs">
                                                <i class="fa-solid fa-check"></i>
                                            </div>
                                            <span class="text-sm text-zinc-400">Discovery</span>
                                        </div>
                                        <div class="flex items-center gap-3">
                                            <div class="w-6 h-6 rounded-full bg-success/20 flex items-center justify-center text-success text-xs">
                                                <i class="fa-solid fa-check"></i>
                                            </div>
                                            <span class="text-sm text-zinc-400">Design</span>
                                        </div>
                                        <div class="flex items-center gap-3">
                                            <div class="w-6 h-6 rounded-full bg-accent flex items-center justify-center text-white text-xs shadow-lg shadow-accent/30">
                                                <i class="fa-solid fa-code"></i>
                                            </div>
                                            <span class="text-sm text-white font-medium">Implement</span>
                                            <span class="text-xs text-zinc-500 ml-auto">80%</span>
                                        </div>
                                        <div class="flex items-center gap-3 opacity-40">
                                            <div class="w-6 h-6 rounded-full bg-surface-300 flex items-center justify-center text-zinc-500 text-xs">
                                                <i class="fa-solid fa-vial"></i>
                                            </div>
                                            <span class="text-sm text-zinc-500">Verify</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </template>

                        <!-- Activity tab -->
                        <template x-if="contextTab === 'activity'">
                            <div class="space-y-3">
                                <div class="flex gap-3 p-3 rounded-lg hover:bg-white/5 cursor-pointer transition-colors">
                                    <div class="w-2 h-2 rounded-full bg-success mt-1.5 shrink-0"></div>
                                    <div>
                                        <p class="text-sm text-zinc-300"><span class="text-success">Completed:</span> Configure environment variables</p>
                                        <p class="text-xs text-zinc-600 mt-0.5">10m ago</p>
                                    </div>
                                </div>
                                <div class="flex gap-3 p-3 rounded-lg hover:bg-white/5 cursor-pointer transition-colors">
                                    <div class="w-2 h-2 rounded-full bg-accent mt-1.5 shrink-0"></div>
                                    <div>
                                        <p class="text-sm text-zinc-300"><span class="text-accent">Created:</span> src/config/env.ts</p>
                                        <p class="text-xs text-zinc-600 mt-0.5">12m ago</p>
                                    </div>
                                </div>
                                <div class="flex gap-3 p-3 rounded-lg hover:bg-white/5 cursor-pointer transition-colors">
                                    <div class="w-2 h-2 rounded-full bg-purple-500 mt-1.5 shrink-0"></div>
                                    <div>
                                        <p class="text-sm text-zinc-300"><span class="text-purple-400">Updated:</span> plan.md</p>
                                        <p class="text-xs text-zinc-600 mt-0.5">15m ago</p>
                                    </div>
                                </div>
                            </div>
                        </template>
                    </div>
                </aside>
            </div>
        </main>
    </div>

    <!-- Decision Toast (for questions) -->
    <div x-show="status === 'waiting'"
         x-transition:enter="transition ease-out duration-300"
         x-transition:enter-start="translate-y-10 opacity-0"
         x-transition:enter-end="translate-y-0 opacity-100"
         class="fixed bottom-24 left-1/2 -translate-x-1/2 z-50 w-full max-w-xl px-4"
         x-cloak>

        <div class="bg-surface-200 border border-warning/30 rounded-2xl shadow-2xl shadow-warning/10 overflow-hidden backdrop-blur-xl">
            <!-- Progress beam -->
            <div class="h-1 bg-warning/20 w-full overflow-hidden">
                <div class="h-full w-full bg-warning animate-beam"></div>
            </div>

            <div class="p-5">
                <!-- Header -->
                <div class="flex items-start gap-4 mb-4">
                    <div class="w-10 h-10 rounded-xl bg-warning/20 flex items-center justify-center text-warning shrink-0">
                        <i class="fa-solid fa-circle-question text-lg"></i>
                    </div>
                    <div class="flex-1">
                        <div class="flex items-center gap-2 mb-1">
                            <h4 class="text-white font-semibold">Decision Required</h4>
                            <span class="px-2 py-0.5 rounded-full bg-surface-300 text-zinc-500 text-[10px]">1 of 2</span>
                        </div>
                        <p class="text-sm text-zinc-400 leading-relaxed">
                            I found a discrepancy in the API spec regarding user roles. Should I proceed with the default 'user' role or strictly enforce defined enums?
                        </p>
                    </div>
                </div>

                <!-- Options -->
                <div class="grid grid-cols-2 gap-3">
                    <button @click="resolveQuestion('default')"
                            class="py-3 px-4 rounded-xl bg-surface-300 hover:bg-surface-400 border border-surface-400 text-sm text-white transition-all text-center">
                        Use Default Role
                    </button>
                    <button @click="resolveQuestion('strict')"
                            class="py-3 px-4 rounded-xl bg-warning hover:bg-warning-light text-black text-sm font-medium transition-all shadow-lg shadow-warning/25 text-center">
                        Enforce Strict Enums
                    </button>
                </div>

                <!-- Other option -->
                <button class="w-full mt-3 py-2 text-xs text-zinc-500 hover:text-zinc-300 transition-colors">
                    <i class="fa-solid fa-pen mr-2"></i>Provide custom instructions
                </button>
            </div>
        </div>
    </div>

    <!-- Failed State Toast -->
    <div x-show="status === 'failed'"
         x-transition:enter="transition ease-out duration-300"
         x-transition:enter-start="translate-y-10 opacity-0"
         x-transition:enter-end="translate-y-0 opacity-100"
         class="fixed bottom-24 left-1/2 -translate-x-1/2 z-50 w-full max-w-xl px-4"
         x-cloak>

        <div class="bg-surface-200 border border-danger/30 rounded-2xl shadow-2xl shadow-danger/10 overflow-hidden backdrop-blur-xl">
            <!-- Error beam -->
            <div class="h-1 bg-danger/20 w-full"></div>

            <div class="p-5">
                <div class="flex items-start gap-4 mb-4">
                    <div class="w-10 h-10 rounded-xl bg-danger/20 flex items-center justify-center text-danger shrink-0">
                        <i class="fa-solid fa-circle-exclamation text-lg"></i>
                    </div>
                    <div class="flex-1">
                        <h4 class="text-white font-semibold mb-1">Workflow Failed</h4>
                        <p class="text-sm text-zinc-400 leading-relaxed">
                            An error occurred while executing the task. The authentication module threw a validation error.
                        </p>
                        <pre class="mt-3 p-3 bg-surface-100 rounded-lg text-xs text-danger/80 font-mono overflow-x-auto border border-danger/20">Error: Invalid token format at line 42</pre>
                    </div>
                </div>

                <div class="flex gap-3">
                    <button @click="status = 'idle'"
                            class="flex-1 py-2.5 px-4 rounded-xl bg-surface-300 hover:bg-surface-400 border border-surface-400 text-sm text-white transition-all text-center">
                        Dismiss
                    </button>
                    <button @click="status = 'running'"
                            class="flex-1 py-2.5 px-4 rounded-xl bg-danger hover:bg-danger-light text-white text-sm font-medium transition-all shadow-lg shadow-danger/25 text-center">
                        <i class="fa-solid fa-rotate-right mr-2"></i>Retry
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Notifications panel -->
    <div x-show="showNotifications"
         x-transition:enter="transition ease-out duration-200"
         x-transition:enter-start="opacity-0 translate-y-2"
         x-transition:enter-end="opacity-100 translate-y-0"
         @click.outside="showNotifications = false"
         class="fixed top-20 left-20 w-80 bg-surface-200 rounded-xl border border-surface-300 shadow-2xl z-50"
         x-cloak>

        <div class="px-4 py-3 border-b border-surface-300 flex items-center justify-between">
            <h3 class="text-sm font-semibold text-white">Notifications</h3>
            <button class="text-xs text-zinc-500 hover:text-zinc-300">Clear all</button>
        </div>

        <div class="max-h-80 overflow-y-auto">
            <template x-for="notification in notifications" :key="notification.id">
                <div class="p-4 border-b border-surface-300 hover:bg-white/5 cursor-pointer transition-colors">
                    <div class="flex items-start gap-3">
                        <div class="w-8 h-8 rounded-lg flex items-center justify-center shrink-0"
                             :class="notification.type === 'success' ? 'bg-success/20 text-success' : notification.type === 'warning' ? 'bg-warning/20 text-warning' : 'bg-accent/20 text-accent'">
                            <i :class="notification.icon" class="text-sm"></i>
                        </div>
                        <div>
                            <p class="text-sm text-zinc-300" x-text="notification.message"></p>
                            <p class="text-xs text-zinc-600 mt-1" x-text="notification.time"></p>
                        </div>
                    </div>
                </div>
            </template>

            <div x-show="notifications.length === 0" class="p-8 text-center">
                <i class="fa-solid fa-bell-slash text-2xl text-zinc-600 mb-2"></i>
                <p class="text-sm text-zinc-500">No notifications</p>
            </div>
        </div>
    </div>

    <!-- Demo controls -->
    <div class="fixed bottom-4 right-4 z-50">
        <button @click="demoOpen = !demoOpen"
                class="w-10 h-10 rounded-full bg-surface-200 border border-surface-300 flex items-center justify-center text-zinc-500 hover:text-white hover:border-accent transition-all shadow-lg">
            <i class="fa-solid fa-sliders"></i>
        </button>

        <div x-show="demoOpen" x-transition
             @click.outside="demoOpen = false"
             class="absolute bottom-12 right-0 w-72 bg-surface-200 rounded-xl border border-surface-300 p-4 shadow-2xl">
            <h4 class="text-xs font-semibold text-zinc-500 uppercase tracking-wider mb-3">Demo Controls</h4>
            <div class="space-y-4">
                <div>
                    <label class="text-xs text-zinc-400 mb-1.5 block">Workflow Status</label>
                    <select x-model="status"
                            class="w-full bg-surface-100 border border-surface-300 rounded-lg px-3 py-2 text-sm text-white">
                        <option value="idle">Idle</option>
                        <option value="running">Running</option>
                        <option value="waiting">Waiting (shows question)</option>
                        <option value="failed">Failed (shows error)</option>
                    </select>
                </div>
                <div>
                    <label class="text-xs text-zinc-400 mb-1.5 block">Quick Actions</label>
                    <div class="grid grid-cols-2 gap-2">
                        <button @click="startWorkflow('implement')"
                                class="px-3 py-2 rounded-lg bg-accent/20 text-accent text-xs font-medium hover:bg-accent/30 transition-colors">
                            Start Workflow
                        </button>
                        <button @click="status = 'idle'; timer = '00:00'; seconds = 0; stopTimer()"
                                class="px-3 py-2 rounded-lg bg-surface-300 text-zinc-400 text-xs font-medium hover:bg-surface-400 transition-colors">
                            Reset
                        </button>
                    </div>
                </div>
                <div class="pt-2 border-t border-surface-300">
                    <label class="flex items-center gap-3 cursor-pointer">
                        <input type="checkbox" x-model="contextOpen" class="rounded bg-surface-100 border-surface-300 text-accent focus:ring-accent">
                        <span class="text-xs text-zinc-400">Show context drawer</span>
                    </label>
                </div>
            </div>
        </div>
    </div>

    <script>
        function app() {
            return {
                activeView: 'dashboard',
                status: 'idle',
                timer: '00:00',
                seconds: 0,
                interval: null,
                inputValue: '',
                contextOpen: true,
                contextTab: 'context',
                showNotifications: false,
                selectedPhase: 0,
                demoOpen: false,

                navItems: [
                    { id: 'dashboard', label: 'Dashboard', icon: 'fa-solid fa-house', hotkey: '⌘1' },
                    { id: 'session', label: 'Session', icon: 'fa-solid fa-terminal', hotkey: '⌘2' },
                    { id: 'tasks', label: 'Tasks', icon: 'fa-solid fa-list-check', hotkey: '⌘3' },
                    { id: 'history', label: 'History', icon: 'fa-solid fa-clock-rotate-left', hotkey: '⌘4' },
                ],

                phases: [
                    {
                        number: '0042',
                        name: 'API Design',
                        status: 'current',
                        meta: '80% complete • 3 tasks remaining',
                        summary: 'Designing and implementing the RESTful API for user authentication. Includes JWT validation, role-based access control, and input validation.',
                        sessions: [
                            { id: 1, date: 'Today', skill: 'Implement', cost: '1.23' },
                            { id: 2, date: 'Yesterday', skill: 'Design', cost: '0.42' },
                        ],
                        artifacts: ['spec.md', 'plan.md', 'tasks.md']
                    },
                    {
                        number: '0041',
                        name: 'Core Engine',
                        status: 'merged',
                        meta: 'Jan 10-14 • 23 tasks • $12.40',
                        summary: 'Built the core processing engine with streaming support and Zod validation. Implemented retry logic with exponential backoff.',
                        sessions: [
                            { id: 1, date: 'Jan 14', skill: 'Verify', cost: '2.00' },
                            { id: 2, date: 'Jan 11-13', skill: 'Implement', cost: '8.30' },
                            { id: 3, date: 'Jan 10', skill: 'Design', cost: '2.10' },
                        ],
                        artifacts: ['spec.md', 'plan.md']
                    },
                    {
                        number: '0040',
                        name: 'Project Setup',
                        status: 'merged',
                        meta: 'Jan 5-9 • 12 tasks • $5.20',
                        summary: 'Initial project scaffolding with TypeScript, ESLint, Prettier, and Vitest. Set up CI/CD with GitHub Actions.',
                        sessions: [
                            { id: 1, date: 'Jan 9', skill: 'Verify', cost: '1.20' },
                            { id: 2, date: 'Jan 5-8', skill: 'Implement', cost: '4.00' },
                        ],
                        artifacts: ['spec.md']
                    },
                ],

                notifications: [
                    { id: 1, type: 'success', icon: 'fa-solid fa-check', message: 'Task T012 completed', time: '10m ago' },
                    { id: 2, type: 'info', icon: 'fa-solid fa-file-plus', message: 'Created src/config/env.ts', time: '12m ago' },
                ],

                get statusLabel() {
                    return {
                        idle: 'Ready',
                        running: 'Running',
                        waiting: 'Input Needed',
                        failed: 'Failed'
                    }[this.status];
                },

                init() {
                    this.$watch('status', (value, oldValue) => {
                        if (value === 'running' && oldValue === 'idle') {
                            this.startTimer();
                            this.activeView = 'session';
                        } else if (value === 'idle' || value === 'failed') {
                            this.stopTimer();
                        }
                        // Timer continues during 'waiting' state
                    });
                },

                handleKeydown(e) {
                    // ⌘K to focus input
                    if ((e.metaKey || e.ctrlKey) && e.key === 'k') {
                        e.preventDefault();
                        document.querySelector('input[type="text"]')?.focus();
                    }

                    // ⌘1-4 for nav
                    if ((e.metaKey || e.ctrlKey) && ['1','2','3','4'].includes(e.key)) {
                        e.preventDefault();
                        const views = ['dashboard', 'session', 'tasks', 'history'];
                        this.activeView = views[parseInt(e.key) - 1];
                    }
                },

                startWorkflow(type) {
                    this.status = 'running';
                    this.activeView = 'session';

                    // Add workflow start message to console
                    const consoleEl = document.getElementById('console');
                    if (consoleEl) {
                        // Clear the empty state div if present
                        const emptyState = consoleEl.querySelector('[x-show="status === \'idle\'"]');
                        if (emptyState) {
                            emptyState.style.display = 'none';
                        }

                        const skillLabels = {
                            implement: 'Implement',
                            orchestrate: 'Orchestrate',
                            design: 'Design',
                            verify: 'Verify'
                        };
                        const msg = document.createElement('div');
                        msg.className = 'flex gap-4 animate-slide-up mb-4';
                        msg.innerHTML = `
                            <span class="text-zinc-600 shrink-0 select-none w-16">Now</span>
                            <span class="text-purple-400 font-semibold">System</span>
                            <span class="text-zinc-400">Starting workflow: <span class="text-accent font-medium">/flow.${type}</span></span>
                        `;
                        consoleEl.appendChild(msg);
                        consoleEl.scrollTo({ top: consoleEl.scrollHeight, behavior: 'smooth' });
                    }

                    // Add notification
                    this.notifications.unshift({
                        id: Date.now(),
                        type: 'info',
                        icon: 'fa-solid fa-play',
                        message: `Started /flow.${type}`,
                        time: 'Just now'
                    });

                    // Demo: switch to waiting after 5 seconds
                    setTimeout(() => {
                        if (this.status === 'running') {
                            this.status = 'waiting';
                        }
                    }, 5000);
                },

                startTimer() {
                    this.seconds = 0;
                    if (this.interval) clearInterval(this.interval);
                    this.interval = setInterval(() => {
                        this.seconds++;
                        const m = Math.floor(this.seconds / 60).toString().padStart(2, '0');
                        const s = (this.seconds % 60).toString().padStart(2, '0');
                        this.timer = `${m}:${s}`;
                    }, 1000);
                },

                stopTimer() {
                    if (this.interval) {
                        clearInterval(this.interval);
                        this.interval = null;
                    }
                },

                sendMessage() {
                    if (!this.inputValue.trim()) return;

                    const console = document.getElementById('console');
                    if (console) {
                        const msg = document.createElement('div');
                        msg.className = 'flex gap-4 animate-slide-up';
                        msg.innerHTML = `
                            <span class="text-zinc-600 shrink-0 select-none w-16">Now</span>
                            <span class="text-emerald-400 font-semibold">You</span>
                            <span class="text-white">${this.inputValue}</span>
                        `;
                        console.appendChild(msg);
                        console.scrollTo({ top: console.scrollHeight, behavior: 'smooth' });
                    }

                    this.inputValue = '';

                    // If waiting, resolve
                    if (this.status === 'waiting') {
                        this.status = 'running';
                    }
                },

                resolveQuestion(choice) {
                    // Add user response to console
                    const console = document.getElementById('console');
                    if (console) {
                        const msg = document.createElement('div');
                        msg.className = 'flex gap-4 animate-slide-up mb-4';
                        msg.innerHTML = `
                            <span class="text-zinc-600 shrink-0 select-none w-16">Now</span>
                            <span class="text-emerald-400 font-semibold">You</span>
                            <span class="text-white">Selected: <span class="px-2 py-0.5 rounded bg-warning/20 text-warning border border-warning/30">${choice}</span></span>
                        `;
                        console.appendChild(msg);
                        console.scrollTo({ top: console.scrollHeight, behavior: 'smooth' });
                    }

                    this.status = 'running';
                    this.notifications.unshift({
                        id: Date.now(),
                        type: 'success',
                        icon: 'fa-solid fa-check',
                        message: `Question answered: ${choice}`,
                        time: 'Just now'
                    });
                }
            };
        }
    </script>
</body>
</html>
